<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="color-scheme" content="light dark">
    <title>Product Details - neurosub</title>
    <link rel="icon" href="https://i.imgur.com/sPngqN7.jpeg" type="image/jpeg">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter & Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap">

    <style>
        /* CSS Variables for Theming (identical to main page) */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-secondary-translucent: rgba(243, 244, 246, 0.7);
            --bg-tertiary: #e5e7eb;
            --bg-modal: #ffffff;
            --border-color: #d1d5db;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-on-accent: #ffffff;
            --accent-primary: #0891b2;
            --accent-primary-glow: #0ea5e9;
            --accent-hover: #06b6d4;
            --header-bg: rgba(255, 255, 255, 0.5);
        }

        html.dark {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0a0a0a;
            --bg-secondary-translucent: rgba(31, 41, 55, 0.5);
            --bg-tertiary: #374151;
            --bg-modal: #1f2937;
            --border-color: #4b5563;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --text-on-accent: #ffffff;
            --accent-primary: #0ea5e9;
            --accent-primary-glow: #0ea5e9;
            --accent-hover: #38bdf8;
            --header-bg: rgba(10, 10, 10, 0.3);
        }
        
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        html[lang="ar"] {
            font-family: 'Cairo', sans-serif;
        }

        /* Re-used styles from main page */
        .neon-highlight {
            box-shadow: 0 0 5px var(--accent-primary-glow), 0 0 10px var(--accent-primary-glow), 0 0 15px var(--accent-primary-glow);
        }
        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
            background-color: var(--bg-modal);
            border-color: var(--border-color);
        }
        .modal-content h3 { color: var(--text-primary); }
        .modal-content p { color: var(--text-secondary); }

        /* Specific styles for Product Details Page */
        .option-card {
            border: 2px solid var(--border-color);
            transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .option-card:hover {
            border-color: var(--accent-primary);
        }

        .option-card.selected {
            border-color: var(--accent-primary-glow);
            background-color: var(--accent-primary-glow) !important; /* Tailwind bg-cyan-500/10 equivalent in dark/light */
            box-shadow: 0 0 15px var(--accent-primary-glow);
            color: var(--text-on-accent);
        }

        html.dark .option-card.selected {
            background-color: rgba(14, 165, 233, 0.2); /* bg-cyan-500/20 */
        }
        html:not(.dark) .option-card.selected {
            background-color: rgba(14, 165, 233, 0.1); /* bg-cyan-500/10 */
        }

        .option-card.selected .option-price,
        .option-card.selected .option-name,
        .option-card.selected .option-info {
             color: var(--text-primary);
        }

        html.dark .option-card.selected .option-price,
        html.dark .option-card.selected .option-name,
        html.dark .option-card.selected .option-info {
             color: var(--text-on-accent);
        }


        .option-card .option-price {
            color: var(--accent-primary);
            transition: color 0.3s;
        }
        .option-card:hover .option-price {
            color: var(--accent-hover);
        }
        
        .loader {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #order-btn:disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header id="header-bar" role="banner" class="sticky top-0 left-0 w-full px-6 md:px-12 py-3 z-40">
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm" style="background-color: var(--header-bg);"></div>
        <div class="relative container mx-auto flex justify-between items-center">
             <a href="index.html" class="flex items-center gap-x-3 text-2xl font-bold motion-light-text">
                <img src="https://i.imgur.com/sPngqN7.jpeg" alt="neurosub Logo" class="w-10 h-10 rounded-full">
                <span>neurosub</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="index.html#products" class="hidden sm:inline-block text-sm font-semibold hover:text-cyan-400 transition-colors" data-translate="back_to_products">Back to Products</a>
                <button id="theme-toggle" class="p-2 rounded-full text-gray-400 hover:bg-gray-700/50 dark:hover:bg-gray-600 transition-colors" title="Toggle theme"></button>
            </div>
        </div>
    </header>

    <!-- Modal (copied from main page) -->
    <div id="order-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-center justify-center p-4 modal-backdrop opacity-0" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content rounded-2xl shadow-2xl p-6 md:p-8 max-w-sm w-full text-center transform scale-95 opacity-0 border">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-cyan-500/20 flex items-center justify-center border-2 border-cyan-500">
                <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <h3 id="modal-title" class="text-xl font-bold mb-2" data-translate="modal_title">Redirecting to Telegram</h3>
            <p class="mb-6" data-translate="modal_text">You will be redirected to our Telegram account to complete your order. Press 'Proceed' to continue.</p>
            <div class="flex justify-center gap-4">
                <button id="modal-cancel-btn" class="px-6 py-2 rounded-lg bg-gray-600 hover:bg-gray-500 text-white font-semibold transition-colors" data-translate="modal_cancel">Cancel</button>
                <a id="modal-proceed-btn" href="#" target="_blank" class="px-6 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-600 text-white font-bold transition-colors neon-highlight" data-translate="modal_proceed">Proceed</a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main role="main" class="container mx-auto px-4 py-8 md:py-16">
        <div id="product-content" class="max-w-6xl mx-auto hidden">
            <!-- Product Details Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-16 items-start">
                
                <!-- Left Column: Image -->
                <div class="w-full aspect-square rounded-2xl overflow-hidden shadow-2xl sticky top-24">
                    <img id="product-image" src="" alt="Product Image" class="w-full h-full object-cover">
                </div>

                <!-- Right Column: Details -->
                <div class="flex flex-col h-full">
                    <h1 id="product-name" class="text-4xl md:text-5xl font-extrabold" style="color: var(--text-primary);"></h1>
                    <p id="product-description" class="mt-4 text-lg" style="color: var(--text-secondary);"></p>
                    
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold" data-translate="available_options">Available Options</h2>
                        <div id="product-options" class="mt-4 space-y-3">
                            <!-- Options will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <div class="mt-auto pt-8">
                         <button id="order-btn" class="w-full py-4 text-lg font-bold rounded-xl transition-all duration-300 transform hover:scale-105" style="background-color: var(--accent-primary); color: var(--text-on-accent);" data-translate="order_now" disabled>
                            Select an option
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="flex flex-col items-center justify-center min-h-[50vh]">
            <div class="loader"></div>
            <p class="mt-4 text-lg font-semibold" data-translate="loading_product" style="color: var(--text-secondary);">Loading Product...</p>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden text-center min-h-[50vh] flex-col justify-center">
            <h2 id="error-title" class="text-3xl font-bold text-red-500"></h2>
            <p id="error-message" class="mt-2 text-lg" style="color: var(--text-secondary);"></p>
            <a href="index.html#products" class="mt-8 inline-block bg-cyan-500 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-cyan-600 transition-all duration-300 transform hover:scale-105 neon-highlight" data-translate="browse_products">
                Browse Products
            </a>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const productDetailsApp = (() => {

        // --- CONFIGURATION & STATE ---
        const DATA_FILE_PATH = 'data/data.json';
        const ICONS = {
            sun: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`,
            moon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`,
        };
        let state = {
            currentProduct: null,
            selectedOption: null,
            currentLang: 'ar',
            isModalOpen: false,
            theme: 'dark',
        };

        // --- DOM ELEMENTS ---
        const dom = {
            html: document.documentElement,
            themeToggleBtn: document.getElementById('theme-toggle'),
            productContent: document.getElementById('product-content'),
            productImage: document.getElementById('product-image'),
            productName: document.getElementById('product-name'),
            productDescription: document.getElementById('product-description'),
            productOptions: document.getElementById('product-options'),
            orderBtn: document.getElementById('order-btn'),
            loadingState: document.getElementById('loading-state'),
            errorState: document.getElementById('error-state'),
            errorTitle: document.getElementById('error-title'),
            errorMessage: document.getElementById('error-message'),
            orderModal: document.getElementById('order-modal'),
            modalContent: document.querySelector('#order-modal .modal-content'),
            modalCancelBtn: document.getElementById('modal-cancel-btn'),
            modalProceedBtn: document.getElementById('modal-proceed-btn'),
        };

        // --- TRANSLATIONS ---
        const translations = {
            en: {
                back_to_products: "Back to Products",
                loading_product: "Loading Product...",
                available_options: "Available Options",
                order_now: "Order Now",
                select_an_option: "Select an option",
                product_not_found_title: "Product Not Found",
                product_not_found_message: "Sorry, we couldn't find the product you're looking for. It might have been moved or removed.",
                fetch_error_title: "Error Loading Data",
                fetch_error_message: "We had trouble fetching the product details. Please try again later.",
                browse_products: "Browse Products",
                modal_title: "Redirecting to Telegram",
                modal_text: "You will be redirected to our Telegram account to complete your order. Press 'Proceed' to continue.",
                modal_cancel: "Cancel",
                modal_proceed: "Proceed",
            },
            ar: {
                back_to_products: "العودة للمنتجات",
                loading_product: "جاري تحميل المنتج...",
                available_options: "الخيارات المتاحة",
                order_now: "اطلب الآن",
                select_an_option: "اختر باقة",
                product_not_found_title: "المنتج غير موجود",
                product_not_found_message: "عذراً، لم نتمكن من العثور على المنتج الذي تبحث عنه. قد يكون قد تم نقله أو إزالته.",
                fetch_error_title: "خطأ في تحميل البيانات",
                fetch_error_message: "واجهتنا مشكلة في جلب تفاصيل المنتج. يرجى المحاولة مرة أخرى في وقت لاحق.",
                browse_products: "تصفح المنتجات",
                modal_title: "التوجيه إلى تيليجرام",
                modal_text: "سيتم توجيهك إلى حسابنا على تيليجرام لإكمال طلبك. اضغط على 'متابعة' للاستمرار.",
                modal_cancel: "إلغاء",
                modal_proceed: "متابعة",
            }
        };

        // --- UTILITY FUNCTIONS ---
        const storage = {
            get: (key, defaultValue) => localStorage.getItem(key) || defaultValue,
            set: (key, value) => localStorage.setItem(key, value),
        };

        const slugify = (text) => (text || '').toString().replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();

        // --- THEME LOGIC ---
        const applyTheme = (theme) => {
            state.theme = theme;
            dom.html.classList.toggle('dark', theme === 'dark');
            dom.themeToggleBtn.innerHTML = theme === 'dark' ? ICONS.sun : ICONS.moon;
        };

        const toggleTheme = () => {
            const newTheme = state.theme === 'dark' ? 'light' : 'dark';
            storage.set('neurosub-theme', newTheme);
            applyTheme(newTheme);
        };

        const initTheme = () => {
            const savedTheme = storage.get('neurosub-theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(savedTheme || (systemPrefersDark ? 'dark' : 'light'));
        };

        // --- LANGUAGE LOGIC ---
        const setLanguage = (lang) => {
            state.currentLang = lang;
            dom.html.lang = lang;
            dom.html.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang][key]) el.innerHTML = translations[lang][key];
            });
            
            // Re-render content if product is already loaded
            if (state.currentProduct) {
                renderProductDetails(state.currentProduct);
            }
        };

        // --- MODAL LOGIC ---
        const showModal = (link) => {
            state.isModalOpen = true;
            dom.modalProceedBtn.href = link;
            dom.orderModal.classList.remove('hidden');
            dom.orderModal.style.display = 'flex';
            setTimeout(() => {
                dom.orderModal.classList.remove('opacity-0');
                dom.modalContent.classList.remove('scale-95', 'opacity-0');
                dom.modalProceedBtn.focus();
            }, 10);
        };

        const hideModal = () => {
            state.isModalOpen = false;
            dom.orderModal.classList.add('opacity-0');
            dom.modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                dom.orderModal.classList.add('hidden');
                dom.orderModal.style.display = 'none';
            }, 300);
        };

        // --- CORE APPLICATION LOGIC ---
        const renderProductDetails = (product) => {
            const lang = state.currentLang;
            const productName = product[`Name_${lang}`] || product.Name;

            document.title = `${productName} - neurosub`;
            dom.productImage.src = product.ImageURL;
            dom.productImage.alt = `Image for ${productName}`;
            dom.productImage.onerror = function() {
                this.onerror=null;
                this.src=`https://placehold.co/600x600/0a0a0a/e5e7eb?text=${encodeURIComponent(productName)}`;
            };
            dom.productName.textContent = productName;
            dom.productDescription.innerHTML = product[`Description_${lang}`] || product.Description;
            
            renderOptions(product.options);
        };
        
        const renderOptions = (options) => {
            dom.productOptions.innerHTML = '';
            const lang = state.currentLang;

            options.forEach((option, index) => {
                const optionCard = document.createElement('div');
                optionCard.className = 'option-card p-4 rounded-xl flex justify-between items-center';
                optionCard.dataset.optionIndex = index;
                
                const optionName = lang === 'ar' ? option.name_ar : option.name;
                const optionInfo = lang === 'ar' ? option.info_ar : option.info;

                optionCard.innerHTML = `
                    <div>
                        <p class="font-bold text-lg option-name">${optionName}</p>
                        <p class="text-sm option-info" style="color: var(--text-secondary);">${optionInfo}</p>
                    </div>
                    <p class="font-extrabold text-xl option-price">${option.price}</p>
                `;
                dom.productOptions.appendChild(optionCard);
            });
        };

        const handleOptionSelect = (e) => {
            const card = e.target.closest('.option-card');
            if (!card) return;

            // Remove 'selected' from all other cards
            dom.productOptions.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
            
            // Add 'selected' to the clicked card
            card.classList.add('selected');

            const optionIndex = parseInt(card.dataset.optionIndex, 10);
            state.selectedOption = state.currentProduct.options[optionIndex];
            
            // Update order button
            dom.orderBtn.disabled = false;
            dom.orderBtn.textContent = translations[state.currentLang].order_now;
            dom.orderBtn.classList.add('neon-highlight');
        };

        const handleOrderClick = () => {
            if (!state.selectedOption) return;

            const lang = state.currentLang;
            const productName = state.currentProduct[`Name_${lang}`] || state.currentProduct.Name;
            const optionName = lang === 'ar' ? state.selectedOption.name_ar : state.selectedOption.name;
            
            const message = `I'm interested in ordering: ${productName} - ${optionName}`;
            const telegramLink = `https://t.me/neurosub1?text=${encodeURIComponent(message)}`;
            
            showModal(telegramLink);
        };
        
        const showError = (type) => {
             const lang = state.currentLang;
             if(type === 'notFound') {
                dom.errorTitle.textContent = translations[lang].product_not_found_title;
                dom.errorMessage.textContent = translations[lang].product_not_found_message;
             } else {
                dom.errorTitle.textContent = translations[lang].fetch_error_title;
                dom.errorMessage.textContent = translations[lang].fetch_error_message;
             }
             dom.loadingState.classList.add('hidden');
             dom.errorState.classList.remove('hidden');
             dom.errorState.style.display = 'flex';
        };

        const fetchDataAndRender = async () => {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const productSlug = urlParams.get('id');

                if (!productSlug) {
                    showError('notFound');
                    return;
                }

                const response = await fetch(DATA_FILE_PATH);
                if (!response.ok) throw new Error('Network response was not ok.');
                
                const data = await response.json();
                const products = data.products || [];

                const product = products.find(p => slugify(p.id || p.Name) === productSlug);

                if (product) {
                    state.currentProduct = product;
                    renderProductDetails(product);
                    dom.loadingState.classList.add('hidden');
                    dom.productContent.classList.remove('hidden');
                } else {
                    showError('notFound');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                showError('fetch');
            }
        };

        const bindEvents = () => {
            dom.themeToggleBtn.addEventListener('click', toggleTheme);
            dom.productOptions.addEventListener('click', handleOptionSelect);
            dom.orderBtn.addEventListener('click', handleOrderClick);

            // Modal events
            dom.modalCancelBtn.addEventListener('click', hideModal);
            dom.orderModal.addEventListener('click', (e) => { if (e.target === dom.orderModal) hideModal(); });
            dom.modalProceedBtn.addEventListener('click', () => setTimeout(hideModal, 200));
            window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && state.isModalOpen) hideModal(); });
        };

        const init = () => {
            // Load preferences first
            const savedLang = storage.get('neurosub-lang', 'ar');
            
            // Initialize systems
            initTheme();
            setLanguage(savedLang);
            bindEvents();

            // Fetch data
            fetchDataAndRender();
        };

        return { init };

    })();

    productDetailsApp.init();

});
</script>

</body>
</html>
