<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="color-scheme" content="light dark">
    <title>neurosub</title>
    <link rel="icon" href="https://i.imgur.com/sPngqN7.jpeg" type="image/jpeg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"></noscript>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap"></noscript>

    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-secondary-translucent: rgba(243, 244, 246, 0.7);
            --bg-tertiary: #e5e7eb;
            --bg-modal: #ffffff;
            --border-color: #d1d5db;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-on-accent: #ffffff;
            --accent-primary: #0891b2;
            --accent-primary-glow: #0ea5e9;
            --accent-hover: #06b6d4;
            --accent-secondary-color: #a855f7;
            --accent-secondary-glow: #c084fc;
            --header-bg: rgba(255, 255, 255, 0.5);
            --motion-text-from: #111827;
            --motion-text-via: #0ea5e9;
            --motion-text-to: #111827;
            --offer-bg: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        html.dark {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0a0a0a;
            --bg-secondary-translucent: rgba(31, 41, 55, 0.5);
            --bg-tertiary: #374151;
            --bg-modal: #1f2937;
            --border-color: #4b5563;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --text-on-accent: #ffffff;
            --accent-primary: #0ea5e9;
            --accent-primary-glow: #0ea5e9;
            --accent-hover: #38bdf8;
            --accent-secondary-color: #c084fc;
            --accent-secondary-glow: #a855f7;
            --header-bg: rgba(10, 10, 10, 0.3);
            --motion-text-from: #e5e7eb;
            --motion-text-via: #0ea5e9;
            --motion-text-to: #e5e7eb;
            --offer-bg: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
        }
        
        html {
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        html[lang="ar"] {
            font-family: 'Cairo', sans-serif;
        }

        .neon-highlight {
            box-shadow: 0 0 5px var(--accent-primary-glow), 0 0 10px var(--accent-primary-glow), 0 0 15px var(--accent-primary-glow);
        }

        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            will-change: transform, box-shadow;
        }

        .card-hover-effect:hover {
            transform: translateY(-10px);
            box-shadow: 0 0 15px var(--accent-primary-glow), 0 0 30px var(--accent-primary-glow);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in-card {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .motion-light-text {
            background: linear-gradient(90deg, var(--motion-text-from), var(--motion-text-via), var(--motion-text-to));
            background-size: 200% auto;
            color: #fff;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-motion 4s linear infinite;
        }

        @keyframes gradient-motion {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }

        .animated-border-container {
            position: relative;
            padding: 2px;
            border-radius: 9999px;
            overflow: hidden;
            background: var(--bg-primary);
            transform: translateZ(0);
        }

        .animated-border-container::before {
            content: '';
            position: absolute;
            z-index: 0;
            top: 50%;
            left: 50%;
            width: 250%;
            height: 250%;
            background: conic-gradient(
                transparent, transparent, transparent, var(--accent-primary-glow), transparent
            );
            transform-origin: center center;
            animation: snake-border-spin 3s linear infinite;
        }
        
        @keyframes snake-border-spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to   { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .social-icon {
            transition: transform 0.3s ease;
        }
        .social-icon:hover {
            transform: scale(1.1);
        }

        .telegram-glow {
            animation: telegram-pulse 2s infinite alternate;
        }
        @keyframes telegram-pulse {
            from { color: #2AABEE; filter: drop-shadow(0 0 4px #2AABEE); }
            to { color: #87cefa; filter: drop-shadow(0 0 10px #2AABEE) drop-shadow(0 0 2px #fff); }
        }

        .instagram-logo-new {
            position: relative;
            width: 4rem;
            height: 4rem;
        }

        .instagram-logo-new,
        .instagram-logo-new::before,
        .instagram-logo-new::after {
            --insta-color: #a855f7;
        }

        .instagram-logo-new {
            border: 6px solid var(--insta-color);
            border-radius: 18px;
            background-color: transparent;
            box-shadow: 0 0 10px var(--insta-color),
                          inset 0 0 5px var(--insta-color);
        }

        .instagram-logo-new::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 6px solid var(--insta-color);
            border-radius: 50%;
            background-color: transparent;
            box-shadow: 0 0 10px var(--insta-color);
        }

        .instagram-logo-new::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--insta-color);
            box-shadow: 0 0 10px var(--insta-color);
        }

        .filter-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .filter-btn:hover {
            background-color: var(--accent-hover);
            color: var(--text-on-accent);
        }
        .filter-btn.active {
            background-color: var(--accent-primary);
            color: var(--text-on-accent);
        }
        
        .status-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 9999px;
            color: white;
            z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        html[dir="rtl"] .status-badge {
            right: auto;
            left: 1rem;
        }
        .status-bestseller { background-color: #f59e0b; }
        .status-in-stock { background-color: #10b981; }
        .status-limited { background-color: #f97316; }
        .status-out-of-stock { background-color: #ef4444; }
        
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
            background-color: var(--bg-modal);
            border-color: var(--border-color);
        }
        .modal-content h3 { color: var(--text-primary); }
        .modal-content p { color: var(--text-secondary); }


        .lang-selector {
            background-color: var(--bg-tertiary);
        }
        .lang-selector button {
            transition: background-color 0.2s, color 0.2s;
            color: var(--text-secondary);
        }
        .lang-selector button.active {
            background-color: var(--accent-primary);
            color: var(--text-on-accent);
        }

        #back-to-top {
            position: fixed;
            right: 2rem;
            bottom: calc(2rem + env(safe-area-inset-bottom));
            background-color: var(--accent-primary);
            color: var(--text-on-accent);
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
            transform: translateY(100px);
            z-index: 45;
            border: none;
            cursor: pointer;
        }
        #back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }
        html[dir="rtl"] #back-to-top {
            right: auto;
            left: 2rem;
        }

        #scroll-prompt {
            bottom: calc(7rem + env(safe-area-inset-bottom));
        }

        .details-btn {
            background-color: var(--accent-primary);
            color: var(--text-on-accent);
        }
        .details-btn:hover {
            background-color: var(--accent-hover);
        }

        #special-offer-section {
            background: var(--offer-bg);
            transition: background 0.3s ease;
        }

        .countdown-item {
            text-align: center;
        }
        .countdown-number {
            font-family: 'Inter', monospace;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
        }
        .countdown-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .offer-cta-btn {
            background-color: var(--accent-secondary-color);
            box-shadow: 0 0 10px var(--accent-secondary-glow), 0 0 20px var(--accent-secondary-glow);
            transition: all 0.3s ease;
        }
        .offer-cta-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-secondary-glow), 0 0 30px var(--accent-secondary-glow);
        }

        .offer-scroller {
            width: 100%;
            overflow: hidden;
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        
        html[dir="rtl"] .offer-scroller {
            -webkit-mask-image: linear-gradient(to left, transparent, black 10%, black 90%, transparent);
            mask-image: linear-gradient(to left, transparent, black 10%, black 90%, transparent);
        }
        
        .offer-scroller:hover .offer-track.is-scrolling {
            animation-play-state: paused;
        }

        .offer-track {
            display: flex;
            gap: 1.5rem;
            width: fit-content;
            will-change: transform;
        }

        .offer-track.is-scrolling {
            animation-name: scroll-left-to-right;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
        
        @keyframes scroll-left-to-right {
            from { transform: translateX(-50%); }
            to { transform: translateX(0); }
        }

        .offer-card {
            flex-shrink: 0;
            width: clamp(280px, 80vw, 350px);
            background-color: var(--bg-secondary-translucent);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .offer-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 15px var(--accent-secondary-glow);
        }
        
    </style>
</head>
<body class="antialiased">

    <header id="header-bar" role="banner" class="fixed top-0 left-0 w-full px-6 md:px-12 py-4 flex justify-between items-center z-40 transition-opacity duration-500 opacity-0">
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity duration-500" id="header-bg" style="background-color: var(--header-bg);"></div>
        <div class="w-full flex justify-end items-center relative gap-4">
             <button id="theme-toggle" class="p-2 rounded-full text-gray-300 dark:text-gray-400 hover:bg-gray-700/50 dark:hover:bg-gray-600 transition-colors" title="Toggle theme">
             </button>
             <a href="https://t.me/neurosub1" target="_blank" class="hidden md:inline-block bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors" data-translate="contact_us">Contact Us</a>
        </div>
    </header>

    <div id="scrolling-header-content" class="fixed z-50 flex flex-col justify-center space-y-4 transition-all duration-500 ease-in-out top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" style="will-change: transform, top, left, right;">
        <div class="flex items-center space-x-4 rtl:space-x-reverse mx-auto">
            <img src="https://i.imgur.com/sPngqN7.jpeg" alt="neurosub Logo" id="scrolling-logo" class="w-24 h-24 md:w-32 md:h-32 object-cover rounded-full transition-all duration-500 ease-in-out">
            <span id="scrolling-name" class="text-4xl md:text-6xl font-bold motion-light-text transition-all duration-500 ease-in-out">neurosub</span>
        </div>
        <div id="language-selector-container" class="animated-border-container transition-all duration-500 ease-in-out w-44 sm:w-52 mx-auto">
            <div class="lang-selector relative z-10 grid grid-cols-2 rounded-full p-1">
                <button data-lang="ar" class="px-4 py-1 text-sm font-semibold rounded-full">العربية</button>
                <button data-lang="en" class="px-4 py-1 text-sm font-semibold rounded-full active">English</button>
            </div>
        </div>
    </div>

    <div id="scroll-prompt" class="fixed left-1/2 -translate-x-1/2 z-50 text-center transition-opacity duration-500 ease-in-out">
        <span class="motion-light-text text-sm font-semibold tracking-widest" data-translate="scroll_down">SCROLL DOWN</span>
        <svg class="w-6 h-6 mx-auto mt-1 text-cyan-400 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
    </div>

    <div id="order-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-center justify-center p-4 modal-backdrop opacity-0" 
         role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content rounded-2xl shadow-2xl p-6 md:p-8 max-w-sm w-full text-center transform scale-95 opacity-0 border">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-cyan-500/20 flex items-center justify-center border-2 border-cyan-500">
                <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <h3 id="modal-title" class="text-xl font-bold mb-2" data-translate="modal_title">Redirecting to Telegram</h3>
            <p class="mb-6" data-translate="modal_text">You will be redirected to our Telegram account to complete your order. Press 'Proceed' to continue.</p>
            <div class="flex justify-center gap-4">
                <button id="modal-cancel-btn" class="px-6 py-2 rounded-lg bg-gray-600 hover:bg-gray-500 text-white font-semibold transition-colors" data-translate="modal_cancel">Cancel</button>
                <a id="modal-proceed-btn" href="#" target="_blank" class="px-6 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-600 text-white font-bold transition-colors neon-highlight" data-translate="modal_proceed">Proceed</a>
            </div>
        </div>
    </div>

    <main role="main">
        <div class="h-screen"></div>

        <section id="hero-section" class="text-center py-20 md:py-32 px-4">
            <div>
                <h1 class="text-4xl md:text-6xl font-extrabold leading-tight" data-translate="hero_title" style="color: var(--text-primary);">
                    Your Gateway to Premium Digital Subscriptions
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg md:text-xl" data-translate="hero_subtitle" style="color: var(--text-secondary);">
                    We provide fast, reliable, and affordable access to the digital tools and entertainment you love. Perfect for creators, students, and professionals.
                </p>
                <a href="#products" class="smooth-scroll mt-8 inline-block bg-cyan-500 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-cyan-600 transition-all duration-300 transform hover:scale-105 neon-highlight" data-translate="browse_products">
                    Browse Products
                </a>
            </div>
        </section>

        <section id="special-offer-section" class="py-16 md:py-24 overflow-hidden hidden">
            <div class="container mx-auto px-6">
                <div class="bg-black/20 backdrop-blur-lg border border-white/10 rounded-3xl p-8 md:p-12 grid md:flex md:flex-row gap-8 md:gap-12 items-center">
                    <div class="text-center md:text-left rtl:md:text-right md:w-1/2">
                        <h2 id="offer-title" class="text-3xl md:text-4xl font-extrabold motion-light-text mb-4" data-translate="offer_title">
                            Limited Time Special Offer!
                        </h2>
                        <p id="offer-description" class="text-base md:text-lg mb-6" data-translate="offer_description" style="color: var(--text-secondary);">
                            Get our exclusive Lifetime Access Pass at a one-time price. Don't miss out!
                        </p>
                        <div id="countdown-timer" class="flex justify-center md:justify-start gap-3 sm:gap-4 my-8">
                        </div>
                        <a id="offer-cta-btn" href="#" class="offer-cta-btn inline-block text-white font-bold py-4 px-10 rounded-full text-lg" data-translate="offer_cta">
                            Claim Offer
                        </a>
                    </div>
                    <div id="offer-visual-container" class="flex justify-center items-center relative md:w-1/2">
                        <img src="https://placehold.co/500x500/0ea5e9/ffffff?text=Special+Offer" alt="Special Offer Placeholder" class="rounded-2xl shadow-2xl max-w-sm w-full">
                    </div>
                </div>
            </div>
        </section>

        <section id="products" class="py-16 md:py-24" style="background-color: var(--bg-secondary-translucent);">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8" data-translate="our_products">Our Products</h2>
                <div class="flex flex-col md:flex-row gap-4 justify-center items-center mb-8 flex-wrap" id="filter-controls">
                    <div id="category-filters" class="flex flex-wrap justify-center gap-2">
                    </div>
                    <div class="w-full md:w-auto">
                        <select id="sort-options" class="w-full md:w-auto rounded-full py-2 px-4 focus:outline-none focus:ring-2" style="background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); focus-ring-color: var(--accent-primary);">
                            <option value="default" data-translate="sort_default">Sort by...</option>
                            <option value="price-asc" data-translate="sort_price_asc">Price: Low to High</option>
                            <option value="price-desc" data-translate="sort_price_desc">Price: High to Low</option>
                            <option value="name-asc" data-translate="sort_name_asc">Name: A-Z</option>
                        </select>
                    </div>
                </div>

                <div class="w-full max-w-md mx-auto mb-12">
                    <div class="animated-border-container">
                        <div class="relative w-full">
                            <input type="text" id="search-input" placeholder="Search for products..." class="relative z-10 w-full border-transparent rounded-full py-3 pl-12 pr-6 placeholder-gray-400 focus:outline-none" style="background-color: var(--bg-tertiary); color: var(--text-primary);" data-translate-placeholder="search_placeholder">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-6 z-20 pointer-events-none" style="color: var(--text-secondary);">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                                </svg>
                            </div>
                            <button id="clear-search-btn" class="absolute inset-y-0 end-0 flex items-center pe-6 z-20 hover:text-white transition-colors hidden" style="color: var(--text-secondary);">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="error-message" class="hidden text-center text-yellow-300 max-w-4xl mx-auto mb-8 p-4 bg-yellow-900/50 border border-yellow-700 rounded-lg"></div>
            <div id="product-grid" class="container mx-auto px-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 md:gap-6">
            </div>
            <div id="no-results-message" class="hidden text-center mt-8 text-lg" style="color: var(--text-secondary);">
                <p data-translate="no_products_found">No products found matching your search.</p>
            </div>
        </section>
    </main>

    <footer role="contentinfo" class="text-center py-20 md:py-32 px-4" style="background-color: var(--bg-secondary); border-top: 1px solid var(--border-color); padding-bottom: calc(5rem + env(safe-area-inset-bottom));">
        <div class="container mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold mb-6" data-translate="follow_us">Follow Us</h2>
            <div class="flex justify-center space-x-8 mb-8">
                <a href="https://t.me/neurosub1" target="_blank" class="social-icon telegram-glow">
                    <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 24 24" aria-label="Telegram Logo"><path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" /></svg>
                </a>
                <a href="https://www.instagram.com/neurosub?igsh=MTU0aXFlZHN3MXE0YQ==" target="_blank" class="social-icon">
                    <div class="instagram-logo-new"></div>
                </a>
            </div>
            <p class="text-sm" data-translate="footer_copyright" style="color: var(--text-secondary);">&copy; 2024 neurosub. All Rights Reserved.</p>
        </div>
    </footer>
    
    <button id="back-to-top" title="Back to top">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    const neurosubApp = (() => {
        const DATA_FILE_PATH = 'data/data.json';
        
        const ICONS = {
            sun: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`,
            moon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`,
        };

        let state = {
            allProducts: [],
            currentLang: 'ar',
            activeCategory: 'All',
            sortOption: 'default',
            isModalOpen: false,
            theme: 'dark',
            countdownInterval: null,
            offerEndDate: null, 
        };

        const dom = {
            html: document.documentElement,
            productGrid: document.getElementById('product-grid'),
            errorMessage: document.getElementById('error-message'),
            noResultsMessage: document.getElementById('no-results-message'),
            headerBar: document.getElementById('header-bar'),
            scrollingHeaderContent: document.getElementById('scrolling-header-content'),
            scrollingLogo: document.getElementById('scrolling-logo'),
            scrollingName: document.getElementById('scrolling-name'),
            scrollPrompt: document.getElementById('scroll-prompt'),
            langSelectorContainer: document.getElementById('language-selector-container'),
            orderModal: document.getElementById('order-modal'),
            modalContent: document.querySelector('#order-modal .modal-content'),
            modalCancelBtn: document.getElementById('modal-cancel-btn'),
            modalProceedBtn: document.getElementById('modal-proceed-btn'),
            categoryFilters: document.getElementById('category-filters'),
            sortOptions: document.getElementById('sort-options'),
            searchInput: document.getElementById('search-input'),
            clearSearchBtn: document.getElementById('clear-search-btn'),
            backToTopBtn: document.getElementById('back-to-top'),
            productsSection: document.getElementById('products'),
            themeToggleBtn: document.getElementById('theme-toggle'),
            specialOfferSection: document.getElementById('special-offer-section'),
            offerTitle: document.getElementById('offer-title'),
            offerDescription: document.getElementById('offer-description'),
            offerCtaBtn: document.getElementById('offer-cta-btn'),
            offerVisualContainer: document.getElementById('offer-visual-container'),
            countdownTimer: document.getElementById('countdown-timer'),
        };

        const translations = {
            en: { 
                contact_us: "Contact Us", scroll_down: "SCROLL DOWN", hero_title: "Your Gateway to Premium Digital Subscriptions", hero_subtitle: "We provide fast, reliable, and affordable access to the digital tools and entertainment you love. Perfect for creators, students, and professionals.", browse_products: "Browse Products", our_products: "Our Products", sort_default: "Sort by...", sort_price_asc: "Price: Low to High", sort_price_desc: "Price: High to Low", sort_name_asc: "Name: A-Z", search_placeholder: "Search for products...", no_products_found: "No products found matching your search.", footer_copyright: "&copy; 2024 neurosub. All Rights Reserved.", follow_us: "Follow Us", modal_title: "Redirecting to Telegram", modal_text: "You will be redirected to our Telegram account to complete your order. Press 'Proceed' to continue.", modal_cancel: "Cancel", modal_proceed: "Proceed", view_details: "View Details", out_of_stock: "Out of Stock", all_category: "All", error_title: "Could Not Load Products!", error_instructions: `<p class="mt-2">We couldn't fetch the product data. Please check if the <code>${DATA_FILE_PATH}</code> file exists and is correctly formatted.</p>`, offer_title: "Limited Time Special Offers!", offer_description: "Check out these exclusive deals, available for a short time only. Don't miss out!", offer_cta: "Claim Offer", countdown_days: "Days", countdown_hours: "Hours", countdown_minutes: "Mins", countdown_seconds: "Secs", offer_expired: "Offer Expired!",
                "status_bestseller": "Bestseller", 
                "status_in_stock": "In Stock", 
                "status_limited": "Limited", 
                "status_out_of_stock": "Out of Stock",
                "category_design": "Design", 
                "category_development": "Development", 
                "category_productivity": "Productivity", 
                "category_streaming": "Streaming", 
                "category_special_offer": "Special Offer"
            },
            ar: { 
                contact_us: "تواصل معنا", scroll_down: "مرر للأسفل", hero_title: "بوابتك للاشتراكات الرقمية المميزة", hero_subtitle: "نحن نوفر وصولاً سريعًا وموثوقًا وبأسعار معقولة للأدوات الرقمية والترفيه الذي تحبه. مثالي للمبدعين والطلاب والمحترفين.", browse_products: "تصفح المنتجات", our_products: "منتجاتنا", sort_default: "الترتيب حسب...", sort_price_asc: "السعر: من الأقل إلى الأعلى", sort_price_desc: "السعر: من الأعلى إلى الأقل", sort_name_asc: "الاسم: أ-ي", search_placeholder: "ابحث عن المنتجات...", no_products_found: "لم يتم العثور على منتجات تطابق بحثك.", footer_copyright: "&copy; 2024 نيوروسب. كل الحقوق محفوظة.", follow_us: "تابعنا", modal_title: "التوجيه إلى تيليجرام", modal_text: "سيتم توجيهك إلى حسابنا على تيليجرام لإكمال طلبك. اضغط على 'متابعة' للاستمرار.", modal_cancel: "إلغاء", modal_proceed: "متابعة", view_details: "عرض التفاصيل", out_of_stock: "نفدت الكمية", all_category: "الكل", error_title: "تعذر تحميل المنتجات!", error_instructions: `<p class="mt-2 text-right">لم نتمكن من جلب بيانات المنتج. يرجى التحقق من وجود ملف <code>${DATA_FILE_PATH}</code> وأنه مهيأ بشكل صحيح.</p>`, offer_title: "عروض خاصة لفترة محدودة!", offer_description: "اكتشف هذه العروض الحصرية، متاحة لفترة قصيرة فقط. لا تفوت الفرصة!", offer_cta: "احصل على العرض", countdown_days: "أيام", countdown_hours: "ساعات", countdown_minutes: "دقائق", countdown_seconds: "ثواني", offer_expired: "انتهى العرض!",
                "status_bestseller": "الأكثر مبيعاً",
                "status_in_stock": "متوفر",
                "status_limited": "محدود",
                "status_out_of_stock": "نفدت الكمية",
                "category_design": "تصميم",
                "category_development": "تطوير",
                "category_productivity": "إنتاجية",
                "category_streaming": "بث",
                "category_special_offer": "عرض خاص"
            }
        };

        const debounce = (func, delay) => {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        };

        const storage = {
            get: (key, defaultValue) => localStorage.getItem(key) || defaultValue,
            set: (key, value) => localStorage.setItem(key, value),
        };
        
        const translateDynamic = (type, key) => {
            if (!key) return '';
            const translationKey = `${type}_${key.replace(/\s+/g, '_').toLowerCase()}`;
            return translations[state.currentLang][translationKey] || key;
        };

        const applyTheme = (theme) => {
            state.theme = theme;
            if (theme === 'dark') {
                dom.html.classList.add('dark');
                dom.themeToggleBtn.innerHTML = ICONS.sun;
            } else {
                dom.html.classList.remove('dark');
                dom.themeToggleBtn.innerHTML = ICONS.moon;
            }
        };

        const toggleTheme = () => {
            const newTheme = state.theme === 'dark' ? 'light' : 'dark';
            storage.set('neurosub-theme', newTheme);
            applyTheme(newTheme);
        };
        
        const initTheme = () => {
            const systemMedia = window.matchMedia('(prefers-color-scheme: dark)');
            const decideAndApplyTheme = () => {
                const savedTheme = storage.get('neurosub-theme');
                applyTheme(savedTheme || (systemMedia.matches ? 'dark' : 'light'));
            };
            decideAndApplyTheme();
            systemMedia.addEventListener('change', decideAndApplyTheme);
        };

        const setLanguage = (lang, isInitial = false) => {
            state.currentLang = lang;
            dom.html.lang = lang;
            dom.html.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang][key]) el.innerHTML = translations[lang][key];
            });
            
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                if (translations[lang][key]) el.placeholder = translations[lang][key];
            });

            dom.langSelectorContainer.querySelectorAll('button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            if (!dom.specialOfferSection.classList.contains('hidden')) {
                startCountdown();
            }

            if (!isInitial) {
                storage.set('neurosub-lang', lang);
                initAppWithData(true);
            }
        };

        const handleScroll = () => {
            const scrollPosition = window.scrollY;
            const scrollThreshold = 50;
            
            dom.scrollPrompt.classList.toggle('opacity-0', scrollPosition > 20);

            if (scrollPosition > scrollThreshold) {
                dom.headerBar.classList.add('opacity-100');
                dom.scrollingHeaderContent.classList.remove('top-1/2', 'left-1/2', '-translate-x-1/2', '-translate-y-1/2', 'flex-col', 'space-y-4');
                dom.scrollingHeaderContent.classList.add('top-4', 'start-6', 'md:start-12', 'flex-row', 'items-center');
                dom.scrollingHeaderContent.querySelector('.flex').classList.add('space-x-4', 'rtl:space-x-reverse');
                dom.scrollingLogo.classList.remove('w-24', 'h-24', 'md:w-32', 'md:h-32');
                dom.scrollingLogo.classList.add('w-8', 'h-8');
                dom.scrollingName.classList.remove('text-4xl', 'md:text-6xl');
                dom.scrollingName.classList.add('text-xl');
                dom.langSelectorContainer.classList.add('hidden');
            } else {
                dom.headerBar.classList.remove('opacity-100');
                dom.scrollingHeaderContent.classList.add('top-1/2', 'left-1/2', '-translate-x-1/2', '-translate-y-1/2', 'flex-col', 'space-y-4');
                dom.scrollingHeaderContent.classList.remove('top-4', 'start-6', 'md:start-12', 'flex-row', 'items-center');
                dom.scrollingHeaderContent.querySelector('.flex').classList.remove('space-x-4', 'rtl:space-x-reverse');
                dom.scrollingLogo.classList.add('w-24', 'h-24', 'md:w-32', 'md:h-32');
                dom.scrollingLogo.classList.remove('w-8', 'h-8');
                dom.scrollingName.classList.add('text-4xl', 'md:text-6xl');
                dom.scrollingName.classList.remove('text-xl');
                dom.langSelectorContainer.classList.remove('hidden');
            }

            dom.backToTopBtn.classList.toggle('visible', scrollPosition > 300);
        };

        const showModal = (link) => {
            state.isModalOpen = true;
            dom.modalProceedBtn.href = link;
            dom.orderModal.classList.remove('hidden');
            dom.orderModal.style.display = 'flex';
            setTimeout(() => {
                dom.orderModal.classList.remove('opacity-0');
                dom.modalContent.classList.remove('scale-95', 'opacity-0');
                dom.modalProceedBtn.focus();
            }, 10);
        };

        const hideModal = () => {
            state.isModalOpen = false;
            dom.orderModal.classList.add('opacity-0');
            dom.modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                dom.orderModal.classList.add('hidden');
                dom.orderModal.style.display = 'none';
            }, 300);
        };

        const updateDisplay = (shouldScroll = false) => {
            let productsToDisplay;
            const searchTerm = dom.searchInput.value.toLowerCase();

            if (state.activeCategory === 'All') {
                productsToDisplay = state.allProducts.filter(p => !p.isSpecialOffer);
            } else if (state.activeCategory === 'Special Offer') {
                productsToDisplay = state.allProducts.filter(p => p.isSpecialOffer);
            } else {
                productsToDisplay = state.allProducts.filter(p => p.Category === state.activeCategory && !p.isSpecialOffer);
            }

            if (searchTerm) {
                productsToDisplay = productsToDisplay.filter(p => {
                    const lang = state.currentLang;
                    const name = (p[`Name_${lang}`] || p.Name || '').toLowerCase();
                    const description = (p[`Description_${lang}`] || p.Description || '').toLowerCase();
                    
                    if (name.includes(searchTerm) || description.includes(searchTerm)) {
                        return true;
                    }
                    
                    return p.options.some(opt => {
                        const optionName = (lang === 'ar' ? opt.name_ar : opt.name).toLowerCase();
                        const optionInfo = (lang === 'ar' ? opt.info_ar : opt.info).toLowerCase();
                        return optionName.includes(searchTerm) || optionInfo.includes(searchTerm);
                    });
                });
            }

            const sortValue = state.sortOption;
            if (sortValue === 'price-asc') {
                productsToDisplay.sort((a, b) => {
                    const priceA = parseFloat((a.options[0]?.price || '0').replace(/[^0-9.-]+/g, ""));
                    const priceB = parseFloat((b.options[0]?.price || '0').replace(/[^0-9.-]+/g, ""));
                    return priceA - priceB;
                });
            } else if (sortValue === 'price-desc') {
                productsToDisplay.sort((a, b) => {
                    const priceA = parseFloat((a.options[0]?.price || '0').replace(/[^0-9.-]+/g, ""));
                    const priceB = parseFloat((b.options[0]?.price || '0').replace(/[^0-9.-]+/g, ""));
                    return priceB - priceA;
                });
            } else if (sortValue === 'name-asc') {
                productsToDisplay.sort((a, b) => {
                    const nameA = a[`Name_${state.currentLang}`] || a.Name || '';
                    const nameB = b[`Name_${state.currentLang}`] || b.Name || '';
                    return nameA.localeCompare(nameB, state.currentLang === 'ar' ? 'ar-EG' : 'en-US');
                });
            }
            
            renderProducts(productsToDisplay);

            dom.noResultsMessage.classList.toggle('hidden', productsToDisplay.length > 0);
            
            if (shouldScroll) {
                dom.productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };
        
        const setupCategoryFilters = () => {
            const allCatText = translations[state.currentLang].all_category;
            const uniqueEnglishCategories = [...new Set(state.allProducts.map(p => p.Category).filter(p => p && !p.isSpecialOffer))];
            const hasSpecialOffers = state.allProducts.some(p => p.isSpecialOffer);

            dom.categoryFilters.innerHTML = ''; 
            
            const allButton = document.createElement('button');
            allButton.textContent = allCatText;
            allButton.className = 'filter-btn px-4 py-2 text-sm font-semibold rounded-full transition-colors';
            allButton.dataset.categoryKey = 'All';
            if (state.activeCategory === 'All') {
                allButton.classList.add('active');
            }
            dom.categoryFilters.appendChild(allButton);

            if (hasSpecialOffers) {
                const offerButton = document.createElement('button');
                offerButton.textContent = translateDynamic('category', 'Special Offer');
                offerButton.dataset.categoryKey = 'Special Offer';
                offerButton.className = 'filter-btn px-4 py-2 text-sm font-semibold rounded-full transition-colors';
                if (state.activeCategory === 'Special Offer') {
                    offerButton.classList.add('active');
                }
                dom.categoryFilters.appendChild(offerButton);
            }

            uniqueEnglishCategories.forEach(englishCategory => {
                const button = document.createElement('button');
                button.textContent = translateDynamic('category', englishCategory);
                button.dataset.categoryKey = englishCategory;
                button.className = 'filter-btn px-4 py-2 text-sm font-semibold rounded-full transition-colors';
                
                if (englishCategory === state.activeCategory) {
                    button.classList.add('active');
                }
                dom.categoryFilters.appendChild(button);
            });
        };

        const renderProducts = (products) => {
            dom.productGrid.innerHTML = '';
            
            if (!products || products.length === 0) {
                 if (dom.searchInput.value === '' && state.activeCategory === 'All' && state.allProducts.length === 0) {
                     for (let i = 0; i < 4; i++) {
                         const skeleton = document.createElement('div');
                         skeleton.className = 'product-skeleton rounded-2xl animate-pulse overflow-hidden';
                         skeleton.innerHTML = `<div class="aspect-square w-full" style="background-color: var(--bg-tertiary);"></div><div class="p-4" style="background-color: var(--bg-secondary);"><div class="h-5 rounded w-3/4 mx-auto mb-3" style="background-color: var(--bg-tertiary);"></div><div class="h-3 rounded w-full mb-2" style="background-color: var(--bg-tertiary);"></div><div class="h-3 rounded w-5/6 mx-auto" style="background-color: var(--bg-tertiary);"></div><div class="h-9 rounded-lg mt-4 w-full" style="background-color: var(--accent-primary-glow); opacity: 0.5;"></div></div>`;
                         dom.productGrid.appendChild(skeleton);
                     }
                }
                 return;
            }

            products.forEach(product => {
                if (product.Name && product.options.length > 0) {
                    dom.productGrid.appendChild(createProductCard(product));
                }
            });
        };

        const createProductCard = (product) => {
            const card = document.createElement('div');
            card.className = 'backdrop-blur-sm rounded-2xl flex flex-col card-hover-effect fade-in-card overflow-hidden relative';
            card.style.backgroundColor = 'var(--bg-secondary-translucent)';
            card.style.border = '1px solid var(--border-color)';

            const lang = state.currentLang;
            
            if (!product.options || product.options.length === 0) {
                return document.createDocumentFragment();
            }

            const productName = product[`Name_${lang}`] || product.Name;
            const productDescription = product[`Description_${lang}`] || product.Description || '';
            const isOutOfStock = product.Status && product.Status.toLowerCase() === 'out of stock';
            const productSlug = (product.id || productName).replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
            
            let statusBadge = '';
            if (product.Status) {
                const statusClass = 'status-' + product.Status.toLowerCase().replace(/ /g, '-');
                const translatedStatus = translateDynamic('status', product.Status);
                statusBadge = `<div class="status-badge ${statusClass}">${translatedStatus}</div>`;
            }

            const prices = product.options
                .map(opt => parseFloat(String(opt.price).replace(/[^0-9.]+/g, '')))
                .filter(p => !isNaN(p));
            
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const currency = (product.options[0]?.price || '').replace(/[0-9.,\s]/g, '');

            let priceDisplay;
            if (prices.length > 0) {
                if (minPrice === maxPrice) {
                    priceDisplay = `${minPrice} ${currency}`;
                } else {
                    priceDisplay = `${minPrice} - ${maxPrice} ${currency}`;
                }
            } else {
                 priceDisplay = 'N/A';
            }

            const actionButtonHTML = isOutOfStock
                ? `<button disabled class="mt-auto bg-red-500 text-white font-bold py-3 px-4 rounded-lg w-full text-base cursor-not-allowed">${translations[lang].out_of_stock}</button>`
                : `<a href="product-details.html?id=${productSlug}" class="details-btn text-center mt-auto font-bold py-3 px-4 rounded-lg transition-colors w-full text-base block">${translations[lang].view_details}</a>`;
            
            card.innerHTML = `
                <div class="relative">
                    ${statusBadge}
                    <img src="${product.ImageURL}" alt="Image for ${productName}" loading="lazy" class="w-full aspect-square object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/0a0a0a/e5e7eb?text=${encodeURIComponent(productName)}';">
                </div>
                <div class="p-4 flex flex-col flex-grow text-center">
                    <h3 class="text-base md:text-lg font-bold" style="color: var(--text-primary);">${productName}</h3>
                    <p class="text-sm my-2 flex-grow" style="color: var(--text-secondary);">${productDescription}</p>
                    <p class="text-lg md:text-xl font-extrabold text-cyan-400 my-4">${priceDisplay}</p>
                    ${actionButtonHTML}
                </div>
            `;
            
            return card;
        };

        const createSpecialOfferCard = (product) => {
            const lang = state.currentLang;
            const productName = product[`Name_${lang}`] || product.Name;
            const productSlug = (product.id || productName).replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();

            const card = document.createElement('div');
            card.className = 'offer-card flex flex-col';

            const priceDisplay = product.options[0] ? `${product.options[0].price}` : '';
            const ctaText = translations[lang].offer_cta;

            let statusBadge = '';
            if (product.Status) {
                const statusClass = 'status-' + product.Status.toLowerCase().replace(/ /g, '-');
                const translatedStatus = translateDynamic('status', product.Status);
                statusBadge = `<div class="status-badge ${statusClass}">${translatedStatus}</div>`;
            }

            card.innerHTML = `
                <div class="relative">
                    ${statusBadge}
                    <img src="${product.ImageURL}" alt="Image for ${productName}" loading="lazy" class="w-full aspect-square object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/0a0a0a/e5e7eb?text=${encodeURIComponent(productName)}';">
                </div>
                <div class="p-4 flex flex-col flex-grow text-center">
                    <h3 class="text-base md:text-lg font-bold" style="color: var(--text-primary);">${productName}</h3>
                    <p class="text-lg font-extrabold text-cyan-400 my-2">${priceDisplay}</p>
                    <a href="product-details.html?id=${productSlug}" class="offer-cta-btn mt-auto inline-block text-white font-bold py-2 px-6 rounded-full text-base">
                        ${ctaText}
                    </a>
                </div>`;
            return card;
        };
        
        const setupSpecialOffers = (products) => {
            dom.offerVisualContainer.innerHTML = '';

            if (products.length === 1) {
                dom.offerVisualContainer.classList.add('flex', 'justify-center', 'items-center');
                const product = products[0];
                const lang = state.currentLang;
                
                dom.offerTitle.textContent = product[`Name_${lang}`] || product.Name;
                dom.offerDescription.textContent = product[`Description_${lang}`] || product.Description;

                const productSlug = (product.id || product.Name).replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
                dom.offerCtaBtn.href = `product-details.html?id=${productSlug}`;
                dom.offerCtaBtn.classList.remove('hidden');

                let statusBadgeHTML = '';
                if (product.Status) {
                    const statusClass = 'status-' + product.Status.toLowerCase().replace(/ /g, '-');
                    const translatedStatus = translateDynamic('status', product.Status);
                    statusBadgeHTML = `<div class="status-badge ${statusClass}">${translatedStatus}</div>`;
                }
                dom.offerVisualContainer.innerHTML = `
                    <div class="relative">
                        ${statusBadgeHTML}
                        <img src="${product.ImageURL}" alt="Special Offer: ${product.Name}" class="rounded-2xl shadow-2xl max-w-sm w-full card-hover-effect" onerror="this.onerror=null;this.src='https://placehold.co/500x500/0ea5e9/ffffff?text=${encodeURIComponent(product.Name)}';">
                    </div>
                `;

            } else if (products.length > 1) {
                dom.offerVisualContainer.classList.remove('flex', 'justify-center', 'items-center');
                
                dom.offerTitle.textContent = translations[state.currentLang].offer_title;
                dom.offerDescription.textContent = translations[state.currentLang].offer_description;
                dom.offerCtaBtn.classList.add('hidden');

                const scroller = document.createElement('div');
                scroller.className = 'offer-scroller';

                const track = document.createElement('div');
                track.className = 'offer-track';

                const duplicatedProducts = [...products, ...products];
                duplicatedProducts.forEach(p => track.appendChild(createSpecialOfferCard(p)));

                scroller.appendChild(track);
                dom.offerVisualContainer.appendChild(scroller);
                
                const animationDuration = products.length * 10;
                track.style.animationDuration = `${animationDuration}s`;

                setTimeout(() => track.classList.add('is-scrolling'), 100);
            }
        };

        const processJsonData = (rawData) => {
            if (!Array.isArray(rawData)) {
                console.error("Product data is not an array:", rawData);
                return [];
            }
            return rawData.reduce((acc, p) => {
                if (p && p.Name && Array.isArray(p.options) && p.options.length > 0) {
                    const isSpecial = p.special_offer === true;
                    acc.push({ ...p, isSpecialOffer: isSpecial });
                }
                return acc;
            }, []);
        };

        const fetchData = async () => {
            renderProducts([]); 
            console.log("Fetching products from JSON file...");

            try {
                const response = await fetch(DATA_FILE_PATH);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const rawJsonData = await response.json();
                
                let products, settings;
                if (Array.isArray(rawJsonData)) {
                    console.warn("JSON data is an array. Consider wrapping it in an object with 'products' and 'settings' keys for new features like `offerEndDate`.");
                    products = rawJsonData;
                    settings = {};
                } else {
                    products = rawJsonData.products || [];
                    settings = rawJsonData.settings || {};
                }

                state.allProducts = processJsonData(products);
                state.offerEndDate = settings.offerEndDate || null;

                if (state.allProducts.length === 0) console.warn("JSON file might be empty, formatted incorrectly, or no valid products were found.");

                dom.errorMessage.classList.add('hidden');
                initAppWithData();

            } catch (error) {
                console.error("Could not load from JSON file:", error);
                const lang = state.currentLang;
                dom.errorMessage.innerHTML = `<strong>${translations[lang].error_title}</strong>${translations[lang].error_instructions}`;
                dom.errorMessage.classList.remove('hidden');
                
                state.allProducts = [];
                initAppWithData();
            }
        };

        const startCountdown = () => {
            if (state.countdownInterval) clearInterval(state.countdownInterval);

            const endDateString = state.offerEndDate;
            let endDate;

            if (endDateString && !isNaN(new Date(endDateString))) {
                endDate = new Date(endDateString);
            } else {
                const now = new Date();
                endDate = new Date(now.getFullYear(), now.getMonth() + 2, 0, 23, 59, 59); 
                if(state.allProducts.length > 0){
                    if (!endDateString) {
                        console.warn(`"offerEndDate" not found in data.json settings. Using fallback date.`);
                    } else {
                        console.warn(`Invalid "offerEndDate" in data.json: "${endDateString}". Using fallback date.`);
                    }
                }
            }


            const updateTimer = () => {
                const now_ms = new Date().getTime();
                const distance = endDate - now_ms;

                if (distance < 0) {
                    clearInterval(state.countdownInterval);
                    dom.countdownTimer.innerHTML = `<div class="text-2xl font-bold text-red-500">${translations[state.currentLang].offer_expired}</div>`;
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                const lang = state.currentLang;
                const labels = {
                    days: translations[lang].countdown_days,
                    hours: translations[lang].countdown_hours,
                    minutes: translations[lang].countdown_minutes,
                    seconds: translations[lang].countdown_seconds
                };
                
                dom.countdownTimer.innerHTML = `
                    <div class="countdown-item">
                        <span class="countdown-number text-2xl md:text-3xl font-bold">${String(days).padStart(2, '0')}</span>
                        <div class="countdown-label">${labels.days}</div>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number text-2xl md:text-3xl font-bold">${String(hours).padStart(2, '0')}</span>
                        <div class="countdown-label">${labels.hours}</div>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number text-2xl md:text-3xl font-bold">${String(minutes).padStart(2, '0')}</span>
                        <div class="countdown-label">${labels.minutes}</div>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number text-2xl md:text-3xl font-bold">${String(seconds).padStart(2, '0')}</span>
                        <div class="countdown-label">${labels.seconds}</div>
                    </div>
                `;
            };

            updateTimer(); 
            state.countdownInterval = setInterval(updateTimer, 1000);
        };

        const bindEvents = () => {
            window.addEventListener('scroll', debounce(handleScroll, 15));
            dom.themeToggleBtn.addEventListener('click', toggleTheme);
            dom.langSelectorContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (btn?.dataset.lang) setLanguage(btn.dataset.lang);
            });

            dom.modalCancelBtn.addEventListener('click', hideModal);
            dom.orderModal.addEventListener('click', (e) => { if (e.target === dom.orderModal) hideModal(); });
            dom.modalProceedBtn.addEventListener('click', () => setTimeout(hideModal, 200));
            
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && state.isModalOpen) hideModal();
            });

            dom.searchInput.addEventListener('input', debounce(() => {
                dom.clearSearchBtn.classList.toggle('hidden', !dom.searchInput.value);
                updateDisplay();
            }, 300));
            dom.clearSearchBtn.addEventListener('click', () => {
                dom.searchInput.value = '';
                dom.clearSearchBtn.classList.add('hidden');
                updateDisplay(true);
            });

            dom.sortOptions.addEventListener('change', (e) => {
                state.sortOption = e.target.value;
                storage.set('neurosub-sort', e.target.value);
                updateDisplay(true);
            });

            dom.backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            document.querySelector('.smooth-scroll').addEventListener('click', function(e) {
                e.preventDefault();
                dom.productsSection.scrollIntoView({ behavior: 'smooth' });
            });

            dom.categoryFilters.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const englishCategoryKey = button.dataset.categoryKey;
                state.activeCategory = englishCategoryKey;
                storage.set('neurosub-category', englishCategoryKey);
                
                dom.categoryFilters.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                updateDisplay(true);
            });
        };

        const loadPreferences = () => {
            state.currentLang = storage.get('neurosub-lang', 'ar'); 
            state.activeCategory = storage.get('neurosub-category', 'All');
            state.sortOption = storage.get('neurosub-sort', 'default');
            dom.sortOptions.value = state.sortOption;
        };

        const initAppWithData = (languageChanged = false) => {
            if (!languageChanged) {
                setLanguage(state.currentLang, true);
            }
            
            const specialOfferProducts = state.allProducts.filter(p => p.isSpecialOffer);

            if (specialOfferProducts.length > 0) {
                dom.specialOfferSection.classList.remove('hidden');
                setupSpecialOffers(specialOfferProducts);
                startCountdown();
            } else {
                dom.specialOfferSection.classList.add('hidden');
            }

            setupCategoryFilters();
            updateDisplay();
        };
        
        const init = () => {
            loadPreferences();
            initTheme(); 
            bindEvents();
            handleScroll();
            fetchData();
        };

        return { init };

    })();

    neurosubApp.init();
});
</script>

</body>
</html>
